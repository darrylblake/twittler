<!DOCTYPE html>
<html>
    <head>
        <script src="jquery.js"></script>
        <script src="data_generator.js"></script>
        <script src="jquery.timeago.js"></script>
    </head>
    <body>
        <section id="tweets"></section>
        <script>
            $(document).ready(function(){
                var avatars = {
                    'douglascalhoun': 'https://media.licdn.com/media/p/4/000/149/320/1c2f421.jpg',
                    'mracus': 'https://media.licdn.com/media/p/8/005/05d/0b0/2645c4a.jpg',
                }


                var $body = $('body');
                //$body.html('');

                function displayStream(stream, length) {
                    function displayNewPosts(stream) {
                        var index = stream.length - 1;

                        while(index >= length){
                            var tweet = stream[index];
                            var time = '<time class="timeago" datetime="' + tweet.created_at.toISOString() + '">' + tweet.created_at.toLocaleDateString() + '</time>';
                            var user = '<a class="user" href="#">@' + tweet.user + '</a>';
                            var $tweet = $('<section id="tweets"></section>');
                            $tweet.html(user + ': ' + tweet.message + ' ' + time);
                            $tweet.prependTo($('#tweets'));
                            index -= 1;
                            $(".timeago").timeago();
                        }
                        return stream.length;
                    }

                    var length = displayNewPosts(stream, 0);
                    setInterval(function(){
                        if (streams.home.length > length)
                            length = displayNewPosts(stream, length);
                    }, 250);
                }


                displayStream(streams.home);
                
            });
        </script>
    </body>
</html>
